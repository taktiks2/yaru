---
description: プロジェクトのPRテンプレートに則ってPRを作成する
argument-hint: [タイトル]
allowed-tools: Bash(git:*), Bash(gh:*), Read
---

# GitHub PR作成コマンド

プロジェクトのPRテンプレート（`.github/PULL_REQUEST_TEMPLATE.md`）に則ってPull Requestを作成してください。

## 手順

### 1. 現在の状態確認

以下のコマンドを並列実行して現在の状態を把握：

- `git status`: 現在のブランチと変更状態を確認
- `git diff main...HEAD`: mainブランチとの差分を確認
- `git log main..HEAD --oneline`: mainからの全コミットを確認
- `gh pr list`: 既存のPRを確認（重複チェック）

### 2. PRボディの構築

PRテンプレートに従って、ボディを作成

### 3. タイトルの決定

- `$ARGUMENTS` が指定されている場合: それをタイトルとして使用
- 指定されていない場合: コミットメッセージから適切なタイトルを生成
- タイトルは日本語で簡潔に（例: "優先度フィールドの追加"、"JSON保存時のバグを修正"）

### 4. 品質チェックの実行

PR作成前に以下を順次実行：

```bash
cargo fmt
cargo clippy -- -D warnings
cargo test
```

- エラーがある場合はユーザーに報告し、修正を促す
- 全て成功した場合のみ次へ進む

### 5. PR作成の実行

```bash
gh pr create --title "タイトル" --body "$(cat <<'EOF'
[PRボディ全体]
EOF
)"
```

### 6. 作成後の確認

- 作成されたPR URLを表示
- ブラウザでの確認を促す

## 重要な注意事項

1. **リモートブランチの確認**: 現在のブランチがリモートにプッシュされているか確認し、されていなければ `git push -u origin <branch>` を実行
2. **mainブランチからのPR禁止**: 現在のブランチがmainの場合はエラーを表示し、フィーチャーブランチの作成を促す
3. **変更がない場合**: diffが空の場合は警告を表示
4. **対話的な確認**: PRボディを作成したら、ユーザーに内容を確認してもらい、承認後に作成
5. **テンプレートの遵守**: すべてのセクションを含め、空欄のまま残さない（推測できない場合は`[TODO: 記載が必要]`とマーク）

## 使用例

```bash
# タイトル指定あり
/create-pr 優先度フィールドの追加

# タイトル指定なし（コミットから自動生成）
/create-pr
```

## エラーハンドリング

- `gh` コマンドが利用できない場合: インストール手順を表示
- リモートリポジトリが設定されていない場合: 設定方法を表示
- 認証エラーの場合: `gh auth login` の実行を促す
